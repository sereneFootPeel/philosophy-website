<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}" th:with="pageTitle=${translationService.getStaticText('my_comments', language)} + ' - ' + ${translationService.getStaticText('philosophy', language)}">
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-balance {
                text-wrap: balance;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .bg-blur {
                backdrop-filter: blur(8px);
            }
            .transition-smooth {
                transition: all 0.3s ease;
            }
            .shadow-md-hover {
                transition: shadow 0.3s ease;
            }
            .shadow-md-hover:hover {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            /* 评论高亮样式 */
            .comment-highlight {
                background-color: var(--bg-tertiary) !important;
                transition: all 0.5s ease;
            }
            .comment-item {
                transition: all 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- 导航栏 -->
    <div th:replace="~{fragments/header :: header}"></div>

    <!-- 主内容区域 -->
    <main class="min-h-screen pb-16" style="padding-top: calc(5rem + 2rem);">
        <div class="container mx-auto px-4">
            <!-- 页面标题 -->
            <div class="bg-white rounded-xl p-6 shadow-md mb-8">
                <h1 class="text-2xl font-bold text-dark mb-2">
                    <i class="fa fa-comment text-primary mr-2"></i>
                    <span th:text="${translationService.getStaticText('my_comments', language)}">我的评论</span>
                </h1>
                <p class="text-gray-600">
                    <span th:text="${translationService.getStaticText('total_comments', language)}">共</span>
                    <span class="font-semibold text-primary" th:text="${commentCount}">0</span>
                    <span th:text="${translationService.getStaticText('comments_count', language)}">条评论</span>
                </p>
            </div>

            <!-- 评论列表 -->
            <div class="bg-white rounded-xl p-6 shadow-md">
                <div class="space-y-4 mb-8">
                    <th:block th:if="${comments.empty}">
                        <div class="text-center text-gray-500 py-12">
                            <i class="fa fa-comment-o text-4xl mb-4"></i>
                            <p class="text-lg" th:text="${translationService.getStaticText('no_comments', language)}">您还没有发表任何评论</p>
                            <p class="text-sm" th:text="${translationService.getStaticText('start_commenting', language)}">去评论区分享您的想法吧！</p>
                        </div>
                    </th:block>
                    <th:block th:each="comment : ${comments}">
                        <div th:id="'comment-' + ${comment.id}" class="border-b border-gray-100 pb-4 last:border-b-0 comment-item relative group cursor-pointer hover:bg-gray-50 transition-colors duration-200"
                             th:onclick="'window.location.href=\'/comments/content/' + ${comment.content.id} + '#comment-' + ${comment.id} + '\''">

                            <div class="flex justify-between items-start mb-2">
                                <a th:href="@{/user/profile/{id}(id=${comment.user.id})}" class="flex items-center hover:bg-gray-50 p-1 rounded-lg transition-smooth" onclick="event.stopPropagation()">
                                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold">
                                        <span th:text="${comment.user != null ? #strings.substring(comment.user.username, 0, 1) : 'U'}">U</span>
                                    </div>
                                    <div class="ml-3">
                                        <div class="flex items-center gap-2">
                                            <p class="font-medium text-dark hover:text-primary" th:text="${comment.user != null ? comment.user.username : '未知用户'}">用户名</p>
                                        </div>
                                        <p class="text-xs text-gray-500" th:text="${comment.createdAt != null ? #temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm') : '未知时间'}">
                                            2023-01-01 12:00
                                        </p>
                                    </div>
                                </a>
                            </div>
                            <p class="text-gray-700 ml-13 mb-3" th:text="${comment.body}">评论内容...</p>

                            <!-- 回复评论 -->
                            <th:block th:if="${comment.replies != null and !comment.replies.isEmpty()}">
                                <div class="ml-8 mt-4 space-y-3">
                                    <th:block th:each="reply : ${comment.replies}">
                                        <div th:id="'reply-' + ${reply.id}" class="border-l-2 border-gray-200 pl-4 py-2 relative group"
                                             th:onclick="'window.location.href=\'/comments/content/' + ${reply.content.id} + '#reply-' + ${reply.id} + '\''">

                                            <div class="flex justify-between items-start mb-1">
                                                <a th:href="@{/user/profile/{id}(id=${reply.user.id})}" class="flex items-center hover:bg-gray-50 p-1 rounded-lg transition-smooth" onclick="event.stopPropagation()">
                                                    <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold">
                                                        <span th:text="${reply.user != null ? #strings.substring(reply.user.username, 0, 1) : 'U'}">U</span>
                                                    </div>
                                                    <div class="ml-2">
                                                        <div class="flex items-center gap-2">
                                                            <p class="text-sm font-medium text-gray-700 hover:text-primary" th:text="${reply.user != null ? reply.user.username : '未知用户'}">用户名</p>
                                                        </div>
                                                        <p class="text-xs text-gray-500" th:text="${reply.createdAt != null ? #temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm') : '未知时间'}">
                                                            2023-01-01 12:00
                                                        </p>
                                                    </div>
                                                </a>
                                            </div>
                                            <p class="text-sm text-gray-600 ml-8" th:text="${reply.body}">回复内容...</p>
                                        </div>
                                    </th:block>
                                </div>
                            </th:block>
                        </div>
                    </th:block>
                </div>
            </div>

            <!-- 返回按钮 -->
            <div class="text-center mt-8">
                <a href="/user/profile" class="inline-flex items-center px-6 py-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fa fa-arrow-left mr-2"></i>
                    <span th:text="${translationService.getStaticText('back_to_profile', language)}">返回个人主页</span>
                </a>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <div th:replace="~{fragments/footer :: footer}"></div>
    <div th:replace="~{fragments/footer :: language-switcher-script}"></div>
    <div th:replace="~{fragments/footer :: like-script}"></div>

    <!-- JavaScript -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 检查URL中是否有评论锚点
            function highlightCommentFromHash() {
                const hash = window.location.hash;
                if (hash && hash.startsWith('#comment-')) {
                    const commentId = hash.substring(1); // 移除#号
                    const commentElement = document.getElementById(commentId);
                    
                    if (commentElement) {
                        // 添加高亮样式
                        commentElement.classList.add('comment-highlight');
                        
                        // 滚动到评论位置，考虑固定导航栏的高度
                        const navbarHeight = document.getElementById('navbar')?.offsetHeight || 80;
                        const elementPosition = commentElement.offsetTop - navbarHeight - 20;
                        
                        window.scrollTo({
                            top: elementPosition,
                            behavior: 'smooth'
                        });
                        
                        // 3秒后移除高亮效果
                        setTimeout(() => {
                            commentElement.classList.remove('comment-highlight');
                        }, 3000);
                    }
                }
            }
            
            // 初始加载时检查
            highlightCommentFromHash();
            
            // 监听hash变化（当用户点击浏览器前进/后退按钮时）
            window.addEventListener('hashchange', highlightCommentFromHash);
            
            // 初始滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
</body>
</html>
