<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${translationService != null ? translationService.getStaticText('content_edit_list', language) + ' - ' + (language != null and language == 'en' ? 'Philosophy Website' : '哲学网站') : '内容编辑列表 - 哲学网站'}">内容编辑列表 - 哲学网站</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-secondary min-h-screen text-gray-800 flex flex-col">
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="flex-grow pt-16">
        <div class="max-w-6xl mx-auto p-4 md:p-8">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-edit me-2"></i><span th:text="${translationService != null ? translationService.getStaticText('content_edit_list', language) : '内容编辑列表'}">内容编辑列表</span></h2>
                    <a href="javascript:history.back()" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i><span th:text="${translationService != null ? translationService.getStaticText('back', language) : '返回'}">返回</span>
                    </a>
                </div>
                
                <!-- 原始内容信息 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0" th:text="${translationService != null ? translationService.getStaticText('original_content', language) : '原始内容'}">原始内容</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong th:text="${translationService != null ? translationService.getStaticText('content_label', language) : '内容：'}">内容：</strong><span th:text="${#strings.abbreviate(content.content, 100)}">原始内容</span></p>
                                <p><strong th:text="${translationService != null ? translationService.getStaticText('philosopher_label', language) : '哲学家：'}">哲学家：</strong><span th:text="${content.philosopher.name}">原始哲学家</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong th:text="${translationService != null ? translationService.getStaticText('school_label', language) : '流派：'}">流派：</strong><span th:text="${content.school.name}">原始流派</span></p>
                                <p><strong th:text="${translationService != null ? translationService.getStaticText('creation_time', language) : '创建时间：'}">创建时间：</strong><span th:text="${content.createdAt != null ? #temporals.format(content.createdAt, 'yyyy-MM-dd HH:mm') : (translationService != null ? translationService.getStaticText('unknown_time', language) : '未知时间')}">创建时间</span></p>
                            </div>
                        </div>
                        <div class="mt-2">
                            <p><strong th:text="${translationService != null ? translationService.getStaticText('content_label', language) : '内容：'}">内容：</strong></p>
                            <div class="border p-3 rounded bg-light" th:utext="${content.content}">原始内容</div>
                        </div>
                    </div>
                </div>
                
                <!-- 用户编辑列表 -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0" th:text="${translationService != null ? translationService.getStaticText('user_edits', language) + ' (' + ${edits.size()} + ')' : '用户编辑 (' + ${edits.size()} + ')'}">用户编辑 (<span th:text="${edits.size()}">0</span>)</h5>
                        <a th:href="@{/user/content-edits/create/{id}(id=${content.id})}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i><span th:text="${translationService != null ? translationService.getStaticText('create_new_edit', language) : '创建新编辑'}">创建新编辑</span>
                        </a>
                    </div>
                    <div class="card-body">
                        <div th:if="${edits.isEmpty()}" class="text-center py-5">
                            <i class="fas fa-edit fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted" th:text="${translationService != null ? translationService.getStaticText('no_user_edits', language) : '暂无用户编辑'}">暂无用户编辑</h5>
                            <p class="text-muted" th:text="${translationService != null ? translationService.getStaticText('no_edits_yet', language) : '还没有用户对此内容进行编辑'}">还没有用户对此内容进行编辑</p>
                            <a th:href="@{/user/content-edits/create/{id}(id=${content.id})}" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i><span th:text="${translationService != null ? translationService.getStaticText('create_first_edit', language) : '创建第一个编辑'}">创建第一个编辑</span>
                            </a>
                        </div>
                        
                        <div th:if="${!edits.isEmpty()}" class="row">
                            <div th:each="edit : ${edits}" class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h6 class="card-title" th:text="${edit.title}">编辑标题</h6>
                                        </div>
                                        
                                        <p class="card-text text-muted small mb-2">
                                            <i class="fas fa-user me-1"></i>
                                            <span th:text="${edit.user.username}">用户名</span>
                                        </p>
                                        
                                        <p class="card-text text-muted small mb-2">
                                            <i class="fas fa-user-tie me-1"></i>
                                            <span th:text="${edit.philosopher.name}">哲学家</span> | 
                                            <i class="fas fa-school me-1"></i>
                                            <span th:text="${edit.school.name}">流派</span>
                                        </p>
                                        
                                        <p class="card-text" th:text="${#strings.abbreviate(edit.content, 150)}">编辑内容预览...</p>
                                        
                                        <div class="d-flex justify-content-between align-items-center mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                <span th:text="${edit.updatedAt != null ? #temporals.format(edit.updatedAt, 'yyyy-MM-dd HH:mm') : (translationService != null ? translationService.getStaticText('unknown_time', language) : '未知时间')}">更新时间</span>
                                            </small>
                                            
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-info btn-sm"
                                                        data-bs-toggle="modal"
                                                        th:data-bs-target="'#editModal' + ${edit.id}">
                                                    <i class="fas fa-eye me-1"></i><span th:text="${translationService != null ? translationService.getStaticText('view', language) : '查看'}">查看</span>
                                                </button>
                                                <a th:href="@{/user/content-edits/edit/{id}(id=${edit.id})}"
                                                   class="btn btn-outline-primary btn-sm"
                                                   th:if="${edit.status != null and edit.status.name() == 'PENDING' and edit.user != null and edit.user.username == authentication.name}">
                                                    <i class="fas fa-edit me-1"></i><span th:text="${translationService != null ? translationService.getStaticText('edit', language) : '编辑'}">编辑</span>
                                                </a>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 编辑详情模态框 -->
    <div th:each="edit : ${edits}" class="modal fade" th:id="'editModal' + ${edit.id}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" th:text="${edit.title}">编辑标题</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong th:text="${translationService != null ? translationService.getStaticText('philosopher_label', language) : '哲学家：'}">哲学家：</strong><span th:text="${edit.philosopher.name}">哲学家</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong th:text="${translationService != null ? translationService.getStaticText('school_label', language) : '流派：'}">流派：</strong><span th:text="${edit.school.name}">流派</span></p>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong th:text="${translationService != null ? translationService.getStaticText('editor_label', language) : '编辑者：'}">编辑者：</strong><span th:text="${edit.user.username}">用户名</span></p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <p><strong th:text="${translationService != null ? translationService.getStaticText('edit_content_label', language) : '编辑内容：'}">编辑内容：</strong></p>
                        <div class="border p-3 rounded bg-light" th:utext="${edit.content}">编辑内容</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="${translationService != null ? translationService.getStaticText('close', language) : '关闭'}">关闭</button>
                </div>
            </div>
        </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
