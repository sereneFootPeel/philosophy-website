<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}" th:with="pageTitle=${language != null and language == 'en' ? 'Philosophy - Login' : '哲学 - 登录'}">
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-smooth {
                transition: all 0.3s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-secondary min-h-screen flex flex-col">
    <div th:replace="~{fragments/header :: header}"></div>
    
    <main class="min-h-screen flex items-center justify-center p-4 pt-20 sm:pt-24">
        <div class="max-w-md w-full bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-4 sm:p-6">
                <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-700 mb-4 sm:mb-6" th:if="${language != null and language == 'en'}" th:text="'Login'">Login</h2>
                <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-700 mb-4 sm:mb-6" th:unless="${language != null and language == 'en'}" th:text="'登录'">登录</h2>
                
                <!-- 消息提示将通过JavaScript显示 -->
                
                <form th:action="@{/login}" method="post">
                    <!-- 隐藏字段：重定向URL -->
                    <input type="hidden" th:name="redirect" th:value="${param.redirect}" />
                    <div class="mb-4">
                        <label for="username" class="block text-gray-700 mb-2" th:if="${language != null and language == 'en'}" th:text="'Username'">Username</label>
                        <label for="username" class="block text-gray-700 mb-2" th:unless="${language != null and language == 'en'}" th:text="'用户名'">用户名</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="username" name="username" 
                                   class="w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent min-h-[44px]"
                                   th:if="${language != null and language == 'en'}" th:placeholder="'Please enter username'" required>
                                   <input type="text" id="username" name="username" 
                                   class="w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent min-h-[44px]"
                                   th:unless="${language != null and language == 'en'}" th:placeholder="'请输入用户名'" required>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label for="password" class="block text-gray-700 mb-2" th:if="${language != null and language == 'en'}" th:text="'Password'">Password</label>
                        <label for="password" class="block text-gray-700 mb-2" th:unless="${language != null and language == 'en'}" th:text="'密码'">密码</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-lock"></i>
                            </span>
                            <input type="password" id="password" name="password" 
                                   class="w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent min-h-[44px]"
                                   th:if="${language != null and language == 'en'}" th:placeholder="'Please enter password'" required>
                                   <input type="password" id="password" name="password" 
                                   class="w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent min-h-[44px]"
                                   th:unless="${language != null and language == 'en'}" th:placeholder="'请输入密码'" required>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center min-h-[44px]">
                            <input type="checkbox" id="remember-me" name="remember-me" 
                                   class="h-5 w-5 text-primary focus:ring-primary border-gray-300 rounded cursor-pointer touch-manipulation">
                            <label for="remember-me" class="ml-2 block text-gray-700 cursor-pointer touch-manipulation" th:if="${language != null and language == 'en'}" th:text="'Remember me'">Remember me</label>
                            <label for="remember-me" class="ml-2 block text-gray-700 cursor-pointer touch-manipulation" th:unless="${language != null and language == 'en'}" th:text="'记住我'">记住我</label>
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-md transition-colors duration-200 min-h-[44px] touch-manipulation active:scale-[0.98]">
                        <span th:if="${language != null and language == 'en'}" th:text="'Login'">Login</span>
                        <span th:unless="${language != null and language == 'en'}" th:text="'登录'">登录</span>
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-gray-600">
                        <span th:if="${language != null and language == 'en'}" th:text="'Don\'t have an account?'">Don't have an account?</span>
                        <span th:unless="${language != null and language == 'en'}" th:text="'还没有账号?'">还没有账号?</span> 
                        <a href="/register" class="text-primary hover:text-primary/80 font-medium" th:if="${language != null and language == 'en'}" th:text="'Register now'">Register now</a>
                        <a href="/register" class="text-primary hover:text-primary/80 font-medium" th:unless="${language != null and language == 'en'}" th:text="'立即注册'">立即注册</a>
                    </p>
                </div>
            </div>
        </div>
    </main>
    
    <div th:replace="~{fragments/footer :: footer}"></div>
    <div th:replace="~{fragments/footer :: language-switcher-script}"></div>
    <div th:replace="~{fragments/footer :: search-script}"></div>
    <div th:replace="~{fragments/footer :: search-modal}"></div>
    <div th:replace="~{fragments/footer :: message-script}"></div>

    <script th:inline="javascript">
        // 显示登录错误提示（使用与主题切换相同的样式）
        function showLoginErrorNotification(errorType, language) {
            let message;
            if (errorType === 'account') {
                message = language === 'en' ? 'Username incorrect' : '用户名错误';
            } else if (errorType === 'password') {
                message = language === 'en' ? 'Password incorrect' : '密码错误';
            } else {
                message = language === 'en' ? 'Username or password incorrect' : '用户名或密码错误';
            }
            
            // Create notification element (样式与主题切换提示相同)
            const notification = document.createElement('div');
            notification.className = 'fixed top-24 left-1/2 transform -translate-x-1/2 bg-primary text-white px-6 py-3 rounded-full shadow-lg z-[9999] transition-all duration-300 text-sm font-medium';
            notification.innerHTML = '<i class="fa fa-exclamation-circle mr-2"></i>' + message;
            notification.style.opacity = '0';
            notification.style.transform = 'translate(-50%, -20px)';
            document.body.appendChild(notification);
            
            // 动画显示
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translate(-50%, 0)';
            }, 10);
            
            // 动画隐藏
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translate(-50%, -20px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 2000);
        }
        
        // 页面加载时检查URL参数并显示消息
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const language = /*[[${language}]]*/ 'zh';
            
            // 从 URL 参数获取错误类型（优先级高）
            const errorParam = urlParams.get('error');
            
            // 检查是否有登录错误
            if (errorParam === 'account' || errorParam === 'password') {
                showLoginErrorNotification(errorParam, language);
            } else if (urlParams.has('error')) {
                // 兼容旧的错误参数（只是 error=true）
                const loginError = /*[[${loginError}]]*/ null;
                if (loginError) {
                    showLoginErrorNotification(loginError, language);
                } else {
                    // 随机选择一个错误类型
                    const randomError = Math.random() < 0.5 ? 'account' : 'password';
                    showLoginErrorNotification(randomError, language);
                }
            }
            
            if (urlParams.has('success')) {
                const message = language === 'en' ? 'Operation successful' : '操作成功';
                showMessage(message, 'success');
            }
            
            if (urlParams.has('logout')) {
                const message = language === 'en' ? 'You have successfully logged out' : '您已成功登出';
                showMessage(message, 'success');
            }
        });
    </script>
</body>
</html>
    